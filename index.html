<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Screen Clicker Game</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: black;
      font-family: Arial, sans-serif;
      overflow: hidden;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    .score-board {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-size: 24px;
      font-family: Arial, sans-serif;
      z-index: 10;
      background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      border-radius: 5px;
    }
    .combo-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: yellow;
      font-size: 48px;
      display: none;
      text-shadow: 0 0 10px rgba(255, 255, 0, 0.7);
      z-index: 20;
    }
    .level-up-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: gold;
      font-size: 72px;
      display: none;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
      z-index: 20;
    }
    .visitor-status {
      position: absolute;
      top: 10px;
      right: 10px;
      color: white;
      font-size: 14px;
      background: rgba(0, 0, 0, 0.5);
      padding: 8px 12px;
      border-radius: 5px;
      z-index: 10;
    }
    .visitor-new {
      color: #4CAF50;
    }
    .visitor-returning {
      color: #2196F3;
    }
  </style>
</head>
<body>
  <div class="score-board">
    Score: <span id="score">0</span><br>
    Highscore: <span id="highscore">0</span>
  </div>
  <div class="visitor-status" id="visitorStatus" hidden>Visitor status: <span>Checking...</span></div>
  <div class="combo-message" id="comboMessage">Combo x1!</div>
  <div class="level-up-message" id="levelUpMessage">Well Done! Level Up!</div>
  <canvas id="canvas"></canvas>

  <script src="index.js"></script>
  <script>
    // db.js
   import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
    import { getFirestore, collection, query, orderBy, limit, getDocs } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCcxCO_FdIaEzXKpHiwWwTxNt7ZRGwcyl8",
      authDomain: "screen-clicker.firebaseapp.com",
      projectId: "screen-clicker",
      storageBucket: "screen-clicker.appspot.com",
      messagingSenderId: "627573962958",
      appId: "1:627573962958:web:048f2577e436a30cf3389f",
      measurementId: "G-W3C5Y2YPBV"
    };


 
const app = initializeApp(firebaseConfig);
export const db = getFirestore(app);
const highscoreRef = doc(db, "game", "highscore");

export let highscore = 0;

export async function loadHighscore() {
  try {
    const docSnap = await getDoc(highscoreRef);
    if (docSnap.exists()) {
      highscore = docSnap.data().value || 0;
      document.getElementById('highscore').innerText = highscore;
    }
  } catch (e) {
    console.error("Erreur chargement highscore:", e);
  }
}

export async function saveHighscore(score) {
  try {
    await setDoc(highscoreRef, { value: score });
  } catch (e) {
    console.error("Erreur de sauvegarde du highscore:", e);
  }
}

export async function trackVisitor() {
  try {
    let username = localStorage.getItem('playerName');
    let isNewVisitor = false;
    const statusSpan = document.querySelector('#visitorStatus span');

    if (!username) {
      username = prompt("Enter your player name:")?.trim();
      if (!username) username = 'Guest_' + Math.floor(Math.random() * 10000);
      localStorage.setItem('playerName', username);
      isNewVisitor = true;
      statusSpan.textContent = "New Player: " + username;
      statusSpan.className = "visitor-new";
    } else {
      statusSpan.textContent = "Welcome Back: " + username;
      statusSpan.className = "visitor-returning";
    }

    const analyticsRef = doc(db, "analytics", "visitorData");
    const visitorRef = doc(db, "visitors", username);

    await setDoc(visitorRef, {
      lastVisit: serverTimestamp(),
      visits: increment(1),
      isNew: isNewVisitor,
      name: username
    }, { merge: true });

    const docSnap = await getDoc(analyticsRef);
    if (docSnap.exists()) {
      await updateDoc(analyticsRef, {
        totalVisits: increment(1),
        uniqueVisitors: isNewVisitor ? increment(1) : increment(0)
      });
    } else {
      await setDoc(analyticsRef, {
        totalVisits: 1,
        uniqueVisitors: isNewVisitor ? 1 : 0
      });
    }

  } catch (error) {
    console.error("Error tracking visitor:", error);
    document.querySelector('#visitorStatus span').textContent = "Error tracking";
  }
}

  </script>
</body>
</html>
